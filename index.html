<!DOCTYPE html>
<html>
  <head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="bootstrap-3.0.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="functionprocessor.js" type="text/javascript"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap-3.0.3/dist/js/bootstrap.min.js"></script>
    <script>
		$(document).ready(function(){
			$('#error-div').hide();
			$('#result-div').hide();
			$('#json-obj').val('{"a":[1,2,3,4]}');
			$('#formula').val('sum(a) / len(a)');
			var functions = {
				'pow' : function(x,y) {
					return Math.pow(x,y)
				},
				'max' : function(values) {
					if (!values) {
						return null;
					} else {
						var max = Number.MIN_VALUE
						values.forEach(function(x) {
							if (x > max) {
								max = x;
							}
						})
						return max;
					}
				},
				'len' : function(a) {
					return a.length
				},
				'sum' : function(a) {
					var total = 0;
					a.forEach(function(x){
						total += x
					});
					return total;
				}
			}

			var fp = new FunctionProcessor(functions);

			$('#calculate').click(function(){
				var formula = $('#formula').val(),
					obj,
					results,
					objString = $('#json-obj').val();

				try {
					if (objString) {
						obj = JSON.parse(objString);
					} else {
						obj = {}
					}
					var result = fp.evaluate(formula,obj)
					reportSuccess(result);
				} catch (err) {
					reportError(err.message);
				}
			});
		});

		function reportError(message) {
			$('#error-output').html(message);
			$('#result-div').hide();
			$('#error-div').show(150);
		}

		function reportSuccess(result) {
			$('#result-output').html(result);
			$('#result-div').show(150);
			$('#error-div').hide();
		}

	</script>
  </head>
  <body>
  	<div class="container col-md-8 col-md-offset-2">
	  	<div class="jumbotron">
	  		<h1>
	  			JS Formula
	  		</h1>
	  		<p>
	  			JS Formula is Javascript class that enables formula evaluation without the use of eval().
	  			Users can perform evaluation on JSON objects using the built in mathmatical opperators 
	  			<strong>+, - , / </strong> and <strong>*</strong> as well as define custom functions that the evaluator can use.
	  			<br/>
	  			<br/>
	  			<a href="#try">Try it out!</a>
	  		</p>
	  	</div>
	  	<h2>How to Use</h2>
	  	<p>
	  		To use JS Formula, just instantiate a new instance of the class FunctionProcessor with a JSON object
	  		of key value pairs for function names to functions. Then to process a forumla call the classes method 
	  		evaluate with the formula first followed by the object you want to evaluate. It's just that simple!
	  	</p>
	  	<div>
	  		<h2>Example</h2>
	  		<pre>
		  		<code>
	var functions = {
		'sin' : function(x) {
			return Math.sin(x)
		},
		'pow' : function(x,y) {
			return Math.pow(x,y)
		}
	}
	var fp = new FunctionProcessor(functions);
	var formula = 'x + 5';
	var obj = {x:20};
	var results = fb.evaluate(formula,obj);
		  		</code>
	  		</pre>
	  	</div>
	  	<div class="col-md-7" id="try">
	  		<h2>Try it!</h2>
		  	<form role="form">
		  		<div class="form-group">
		  			<label for="json-obj">JSON Object</label>
		  			<textarea id="json-obj" class="form-control"></textarea>
		  		</div>
		  		<div class="form-group">
		  			<label for="formula">Formula</label>
		  			<input type="text" class="form-control" id="formula"/>
		  		</div>
		  		<input class="btn btn-primary btn-block" type="button" id="calculate" value="calculate"/>
		  	</form>
		  	<div id="result-div" class="alert alert-success">
				<strong>Result</strong>
				<span id="result-output"></span>
			</div>
			<div id="error-div" class="alert alert-danger">
				<strong>Error</strong>
				<span id="error-output"></span>
			</div>
		</div>
		<div class="col-md-5 panel-group" id="test-methods">
			<h2>Functions Included for Demo</h2>
			<div class="panel">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
							sin(x)
						</a>
					</h4>
				</div>
				<div id="collapseOne" class="panel-collapse collapse">
					<div class="panel-body">
						<pre>
							<code>
function(x) {
	return Math.sin(x)
}
							</code>
						</pre>
					</div>
				</div>
			</div>
			<div class="panel">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
							pow(x,y)
						</a>
					</h4>
				</div>
				<div id="collapseTwo" class="panel-collapse collapse">
					<div class="panel-body">
						<pre>
							<code>
function(x,y) {
	return Math.pow(x,y)
}
							</code>
						</pre>
					</div>
				</div>
			</div>
			<div class="panel">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
							max(a)
						</a>
					</h4>
				</div>
				<div id="collapseThree" class="panel-collapse collapse">
					<div class="panel-body">
						<pre>
							<code>
function(values) {
	if (!values) {
		return null;
	} else {
		var max = Number.MIN_VALUE
		values.forEach(function(x) {
			if (x > max) {
				max = x;
			}
		})
		return max;
	}
}
							</code>
						</pre>
					</div>
				</div>
			</div>
			<div class="panel">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">
							len(a)
						</a>
					</h4>
				</div>
				<div id="collapseFour" class="panel-collapse collapse">
					<div class="panel-body">
						<pre>
							<code>
function(a) {
	return a.length
}
							</code>
						</pre>
					</div>
				</div>
			</div>
			<div class="panel">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseFive">
							sum(a)
						</a>
					</h4>
				</div>
				<div id="collapseFive" class="panel-collapse collapse">
					<div class="panel-body">
						<pre>
							<code>
function(a) {
	var total = 0;
	a.forEach(function(x){
		total += x
	});
	return total;
}
							</code>
						</pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div>
		<div class="container col-md-8 col-md-offset-2">
		shot goes here yo!
		</div>
	</div>
  </body>
</html>