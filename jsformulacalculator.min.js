var JSFormulaCalculator=function(){var p={},u={},r=!0,w={"+":{precedence:1,func:function(d,b){return d+b},arguments:2,type:4},"-":{precedence:1,func:function(d,b){return d-b},arguments:2,type:4},"*":{precedence:2,func:function(d,b){return d*b},arguments:2,type:4},"/":{precedence:2,func:function(d,b){return d/b},arguments:2,type:4},"^":{precedence:3,func:function(d,b){return Math.pow(d,b)},arguments:2,type:4}},x=/^{.*?}/,s=null,y=/^\+|^-|^\/|^\*|^\^/,t=function(d,b){if(d){var a=d.exec(b);return a?
a[0]:a}return null},v=function(d){for(var b=0,a,c=0,g=d.length;c<g;c++)if(a=d[c],"("===a)b++;else if(")"===a&&(b--,0===b))return c;throw"No Closing Parentheses found";},m=function(d,b){if(1===d.type){for(var a=[],c=0,g=d.params.length;c<g;c++)a.push(m(d.params[c],b));return d.func.apply(this,a)}if(2===d.type){for(var a=d.val.split("."),c=b,g=0,f=a.length;g<f;g++)c=c[a[g]];return c}if(3===d.type)return d.val},q=function(d){var b;if(r&&(b=u[d]))return b;if(!b){var a=0;b=[];for(var c,g,f,h=d.length,
e;a<h;)if(f=d.substring(a).trim(),c=d.substring(a,a+1),'"'===c||"'"===c){e=d.indexOf(c,a+1);if(-1==e)throw"Quote miss match";b.push({type:3,val:d.substring(a,a+e+2)});a+=a+e+2}else if("("===c)e=v(f),c=q(f.substring(1,e)),b.push(c),a=a+e+2;else if(g=t(x,f))c=g.replace("{","").replace("}",""),b.push({type:2,val:c}),a=a+1+g.length;else if(g=t(s,f)){e=g.indexOf("(");c=g.substring(0,e);g.substring(e);g=v(f);f=f.substring(e+1,g+1);e=0;for(var l=[],n=0,k=void 0,m=f.length;e<m;)if(k=f[e],"("===k)n++,e++;
else if(")"===k){n--;if(-1==n){f=f.substring(0,e);break}e++}else","===k&&0==n?(l.push(f.substring(0,e)),f=f.substring(e+1),m=f.length,e=0):e++;l.push(f);f=l;e=[];l=0;for(n=f.length;l<n;l++)e.push(q(f[l]));b.push({type:1,func:p[c],params:e});a=a+2+g}else if(g=t(y,f))if("-"!=g||0!=b.length&&4!==b[b.length-1].type)c=w[g],b.push(c),a=a+1+g.length;else{e=f.indexOf(" ");-1===e&&(e=f.length);try{b.push({type:3,val:Number(f.substring(0,e))}),a=a+1+e}catch(z){throw"Invalid use of -; If you want to negate a variable or function times it by -1";
}}else{e=f.indexOf(" ");-1===e?(c=f,e=c.length):c=f.substring(0,e);if(isNaN(c))throw"This is not an acceptable token: "+c;b.push({type:3,val:new Number(c)});a=a+1+e}a=[];h=[];g=0;for(f=b.length;g<f;g++)if(c=b[g],4!==c.type)h.push(c);else{if(0!==a.length)for(e=a[a.length-1];e&&e.precedence>=c.precedence;)h.push(a.pop()),e=a.length,e=0<e?a[a.length-1]:null;a.push(c)}for(;c=a.pop();)h.push(c);b=h;a=0;c=b.length;for(b=b.slice(0);a<c;)if(h=b[a],4!==h.type)a++;else{g=[];for(c=h.arguments;0<c;)try{g.push(b[a-
c]),c--}catch(A){throw"Malformed Expression";}b.splice(a-h.arguments,h.arguments+1,{type:1,params:g,func:h.func});a-=1;c=b.length}if(1!==b.length)throw"Malformed Expression";b=b[0];r&&(u[d]=b);return b}},k=function(d,b){var a=q(d);return m(a,b)};k.setFunctions=function(d){var b=[];p=d;for(var a in p)p.hasOwnProperty(a)&&b.push("^"+a+"\\(");b?(d=b.join("|"),s=RegExp(d)):s=null};k.setCacheEnabled=function(d){r=d};k.getFunction=function(d){var b=q(d);return function(a){return m(b,a)}};return{noConflict:function(){return k}}}(),
_eval=_eval||JSFormulaCalculator.noConflict();
